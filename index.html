<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chill Verse</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;500;700&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <style>
    body { font-family: 'Comfortaa', cursive; background: linear-gradient(135deg, #0f0f23, #1a1a3e); color: #e0e7ff; }
    .glass { background: rgba(255,255,255,0.05); backdrop-filter: blur(12px); border: 1px solid rgba(168,85,247,0.3); }
    .glow { text-shadow: 0 0 20px #a855f7; }
    .btn:hover { transform: translateY(-4px); box-shadow: 0 15px 40px rgba(168,85,247,0.5); }
  
  .error-text {
            color: #ef4444;
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: none;
        }
        
        .error-text.show {
            display: block;
        }
        
        .verification-message {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgb(59, 130, 246);
            color: rgb(59, 130, 246);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
            display: none;
        }
        
        .verification-message.show {
            display: block;
        }
        
        .input-error {
            border-color: #ef4444 !important;
            background: rgba(239, 68, 68, 0.05) !important;
        }
        
        .reset-password-link {
            color: #3b82f6;
            text-decoration: none;
            font-size: 0.875rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        
        .reset-password-link:hover {
            color: #1d4ed8;
        }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
  <div class="glass p-10 rounded-3xl shadow-2xl max-w-md w-full">
    <h1 class="text-5xl md:text-6xl font-bold glow text-center mb-10 bg-clip-text text-transparent bg-gradient-to-r from-purple-400 via-pink-400 to-cyan-400">
      Chill Verse
    </h1>

<!-- Verification Message -->
       <div class="verification-message" id="verificationMessage">
           Please verify email before login
       </div>
       
    <!-- Login -->
    <form id="loginForm" class="space-y-6">
    <div>
      <input type="email" id="email" placeholder="Email" class="w-full px-6 py-4 bg-white/10 rounded-xl border border-purple-500/50 focus:border-cyan-400 outline-none" required>
      <div class="error-text" id="emailError">Invalid account</div>
      </div>
      <div>
      <input type="password" id="pass" placeholder="Password" class="w-full px-6 py-4 bg-white/10 rounded-xl border border-purple-500/50 focus:border-cyan-400 outline-none" required>
      <div class="error-text" id="passwordError">Incorrect Password</div>
      </div>
      <button type="submit" class="w-full py-4 bg-gradient-to-r from-purple-600 to-cyan-500 rounded-xl font-bold text-xl glow btn transition">Login</button>
      
      <!-- Reset Password Link -->
      <div class="text-right">
      <a href="https://multiverse--chill.firebaseapp.com/__/auth/action" id="resetPasswordLink" class="reset-password-link">Forgot Password?</a>
      </div>
      
      <p class="text-left">No account? <span onclick="toggleForm()" class="text-cyan-400 cursor-pointer underline">Register</span></p>
    </form>

    <!-- Register -->
    <div id="register" class="hidden space-y-6">
      <input type="text" id="username" placeholder="Username (character name)" class="w-full px-6 py-4 bg-white/10 rounded-xl border border-purple-500/50 focus:border-cyan-400 outline-none">
      <input type="email" id="reg-email" placeholder="Email" class="w-full px-6 py-4 bg-white/10 rounded-xl border border-purple-500/50 focus:border-cyan-400 outline-none" required>
      <input type="password" id="reg-pass" placeholder="Password" class="w-full px-6 py-4 bg-white/10 rounded-xl border border-purple-500/50 focus:border-cyan-400 outline-none" required>
      <button onclick="register()" class="w-full py-4 bg-gradient-to-r from-pink-600 to-purple-600 rounded-xl font-bold text-xl glow btn transition">Create Account</button>
      <p class="text-center"><span onclick="toggleForm()" class="text-cyan-400 cursor-pointer underline">Back to Login</span></p>
    </div>

    <p id="msg" class="text-center mt-6 text-yellow-300 font-bold"></p>
  </div>

<script>
// YOUR REAL CONFIG (already inserted!)
const firebaseConfig = {
  apiKey: "AIzaSyC9pXU2ZhqUTvQkwgaPOacFeVZcU7grqGQ",
  authDomain: "multiverse--chill.firebaseapp.com",
  projectId: "multiverse--chill",
  storageBucket: "multiverse--chill.firebasestorage.app",
  messagingSenderId: "1098599346366",
  appId: "1:1098599346366:web:cbf32c2991abcec78eeeef"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();

function toggleForm() {
  document.getElementById('loginForm').classList.toggle('hidden');
  document.getElementById('register').classList.toggle('hidden');
  document.getElementById('msg').textContent = '';
}

function register() {
  const email = document.getElementById('reg-email').value;
  const password = document.getElementById('reg-pass').value;
  const username = document.getElementById('username').value;
  auth.createUserWithEmailAndPassword(email, password)
    .then(user => {
      user.user.updateProfile({displayName: username});
      user.user.sendEmailVerification();
      document.getElementById('msg').textContent = "Account created! Check your email to verify.";
    })
    .catch(err => document.getElementById('msg').textContent = err.message);
}

      // Track failed attempts and lockout
      let failedAttempts = 0;
      const MAX_FAILED_ATTEMPTS = 3;
      const LOCKOUT_DURATION = 10000; // 10 seconds in milliseconds
      let isLockedOut = false;

      // Check for pending verification on page load
      window.addEventListener('load', () => {
          const pendingVerification = localStorage.getItem('pendingEmailVerification');
          if (pendingVerification) {
              const verificationMessage = document.getElementById('verificationMessage');
              verificationMessage.classList.add('show');
              localStorage.removeItem('pendingEmailVerification');
              
              // Auto-hide after 5 seconds
              setTimeout(() => {
                  verificationMessage.classList.remove('show');
              }, 5000);
          }
      });

      // Reset Password Link Handler
      document.getElementById('resetPasswordLink').addEventListener('click', (e) => {
          e.preventDefault();
          const email = document.getElementById('email').value.trim();
          
          if (!email) {
              alert('Please enter your email address to reset password');
              return;
          }
          
          // Simulate sending reset email
          alert(`Password reset link has been sent to ${email}`);
          // In production, this would make an API call to send the reset email
      });

  // Login Forn Handler
document.getElementById('loginForm').addEventListener('submit', (e) => {
    e.preventDefault();

    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('pass').value;

    clearErrors();

    if (!email || !password) {
        alert('Please fill email and password');
        return;
    }

    auth.signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
            if (!userCredential.user.emailVerified) {
                auth.signOut();
                document.getElementById('verificationMessage').classList.add('show');
                setTimeout(() => document.getElementById('verificationMessage').classList.remove('show'), 7000);
                alert('Please verify your email first!');
                return;
            }

            // REAL SUCCESS
            window.location.href = "home.html";
        })
        .catch((error) => {
            if (error.code === 'auth/user-not-found' || error.code === 'auth/invalid-credential') {
                showEmailError();
            } else if (error.code === 'auth/wrong-password') {
                showPasswordError();
            } else {
                alert(error.message);
            }
        });
});

      function showEmailError() {
          const emailInput = document.getElementById('email');
          const emailError = document.getElementById('emailError');
          emailInput.classList.add('input-error');
          emailError.classList.add('show');
      }

      function showPasswordError() {
          const passwordInput = document.getElementById('pass');
          const passwordError = document.getElementById('passwordError');
          passwordInput.classList.add('input-error');
          passwordError.classList.add('show');
      }

      function clearErrors() {
          const emailInput = document.getElementById('email');
          const passwordInput = document.getElementById('pass');
          const emailError = document.getElementById('emailError');
          const passwordError = document.getElementById('passwordError');

          emailInput.classList.remove('input-error');
          passwordInput.classList.remove('input-error');
          emailError.classList.remove('show');
          passwordError.classList.remove('show');
      }

      function handleFailedAttempt() {
          if (failedAttempts >= MAX_FAILED_ATTEMPTS) {
              isLockedOut = true;
              showLockoutPopup();
              
              // Unlock after 10 seconds
              setTimeout(() => {
                  isLockedOut = false;
                  failedAttempts = 0;
              }, LOCKOUT_DURATION);
          }
      }

      function showLockoutPopup() {
          const popupHTML = `
              <div id="lockoutOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                  <div class="glass rounded-lg p-8 max-w-sm mx-4 text-center">
                      <h2 class="text-2xl font-bold text-white mb-4">Access Limited</h2>
                      <p class="text-white mb-6">You have entered an incorrect password thrice. Try again after 10 secs.</p>
                      <button id="lockoutCloseBtn" class="w-full bg-white text-purple-600 font-bold py-2 rounded-lg hover:bg-opacity-90 transition">
                          OK
                      </button>
                  </div>
              </div>
          `;
          
          document.body.insertAdjacentHTML('beforeend', popupHTML);
          
          const closeBtn = document.getElementById('lockoutCloseBtn');
          const overlay = document.getElementById('lockoutOverlay');
          
          closeBtn.addEventListener('click', () => {
              overlay.remove();
          });
          
          // Auto-close after 10 seconds
          setTimeout(() => {
              if (document.getElementById('lockoutOverlay')) {
                  overlay.remove();
              }
          }, LOCKOUT_DURATION);
      }
  </script>
  </body>
        </html>
